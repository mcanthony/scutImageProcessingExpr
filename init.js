define(function(require,exports,module){function a(){return q.getImageData(0,0,o.width,o.height)}function b(){var b,c,d,e,f=a(),g=f.data,h=[];g=l.arrToMap(g,o.width);for(var i=0,k=g.length;k>i;i++)for(var m=0,n=g[i].length;n>m;m++)b=c=d=e=p=g[i][m],i>0?b=g[i-1][m]:i!==k-1&&(c=g[i+1][m]),m>0?d=g[i][m-1]:m!==n-1&&(e=g[i][m+1]),h.push(p.r-(b.r+c.r+d.r+e.r-4*p.r)),h.push(p.g-(b.g+c.g+d.g+e.g-4*p.g)),h.push(p.b-(b.b+c.b+d.b+e.b-4*p.b)),h.push(255);f.data.set(h),j(f)}function c(a,b){b=b||x,b||(b=function(){this.processRgb(function(a,b,c){return{r:a,g:b,b:c}})});var c=new Image;c.src=a,c.onload=function(){s.width=o.width=c.width,s.height=o.height=c.height,q.drawImage(c,0,0),b.apply(exports)}}function d(b){var c=a(),d=c.data,e=[];d=l.arrToMap(d,o.width);for(var f=0,g=d.length;g>f;f++)for(var h=0,i=d[f].length;i>h;h++){for(var k={r:[],g:[],b:[]},m=f-b;f+b+1>m;m++)for(var n=h-b;h+b+1>n;n++){var p=d[f][h];m>0&&g>m&&n>0&&i>n&&(p=d[m][n]),k.r.push(p.r),k.g.push(p.g),k.b.push(p.b)}e.push(l.median(k.r)),e.push(l.median(k.g)),e.push(l.median(k.b)),e.push(255)}c.data.set(e),j(c)}function e(b){var c=a(),d=c.data,e=[],f=Math.pow(2*b+1,2);d=l.arrToMap(d,o.width);for(var g=0,h=d.length;h>g;g++)for(var i=0,k=d[g].length;k>i;i++){for(var m={r:0,g:0,b:0},n=g-b;g+b+1>n;n++)for(var p=i-b;i+b+1>p;p++){var q=d[g][i];n>0&&h>n&&p>0&&k>p&&(q=d[n][p]),m.r+=q.r,m.g+=q.g,m.b+=q.b}e.push(m.r/f),e.push(m.g/f),e.push(m.b/f),e.push(255)}c.data.set(e),j(c)}function f(b,c){for(var d,e,f,g,h=a(),i=h.data,k=0,m=i.length;m>k;k+=4){if(d=i[k],e=i[k+1],f=i[k+2],"yuv"===c){var n=l.rgbToYuv(d,e,f);g=b(n.y,n.u,n.v),g=l.yuvToRgb(g.y,g.u,g.v)}else g=b(d,e,f);i[k]=g.r,i[k+1]=g.g,i[k+2]=g.b}j(h)}function g(a){f(a,"rgb")}function h(a){f(a,"yuv")}function i(a){c(m,a)}function j(a){t.putImageData(a,0,0)}function k(a){return x=a,exports}var l=require("util"),m=window.sample||"sample.jpg",n=$("#canvas"),o=n[0],q=o.getContext("2d"),r=$("#target-canvas"),s=r[0],t=s.getContext("2d"),u=$("#input"),v=u[0],w=new FileReader,x=null;w.onload=function(a){var b=a.target.result;c(b)},n.on("click",function(){u.click()}),u.on("change",function(){w.readAsDataURL(v.files[0])});var exports={laplacian:b,medianFilter:d,meanFilter:e,processRgb:g,processYuv:h,ready:i,setDefaultProcessor:k};module.exports=exports});